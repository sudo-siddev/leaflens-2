{% extends 'base.html' %}
{% block pagetitle %}
LeafLens - Documentation
{% endblock pagetitle %}

{% block body %}
<style>
    .doc-section {
        margin: 2rem 0;
        padding: 1.5rem;
        background: var(--bg-secondary);
        border-radius: 15px;
        box-shadow: 0 5px 15px var(--shadow);
        border: 1px solid var(--border-color);
    }

    .doc-section h3 {
        color: var(--accent-primary);
        font-weight: 700;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid var(--accent-primary);
    }

    .tech-stack-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin: 1rem 0;
    }

    .tech-item {
        background: var(--bg-primary);
        padding: 1rem;
        border-radius: 10px;
        border: 1px solid var(--border-color);
        text-align: center;
        transition: all 0.3s ease;
    }

    .tech-item:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px var(--shadow);
    }

    .tech-item h5 {
        color: var(--accent-primary);
        margin-bottom: 0.5rem;
    }

    .code-block {
        background: var(--bg-primary);
        border: 1px solid var(--border-color);
        border-radius: 10px;
        padding: 1.25rem;
        margin: 1rem 0;
        font-family: 'Courier New', 'Consolas', 'Monaco', monospace;
        font-size: 0.9rem;
        line-height: 1.8;
        overflow-x: auto;
        color: var(--text-primary);
        white-space: pre;
        position: relative;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    [data-theme="dark"] .code-block {
        background: #1a1a2e;
        border-color: #2d2d44;
        color: #e0e0e0;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    }

    [data-theme="light"] .code-block {
        background: #f8f9fa;
        border-color: #dee2e6;
        color: #212529;
    }

    .code-block::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: var(--gradient-green);
        border-radius: 10px 10px 0 0;
    }

    .code-block code {
        display: block;
        color: inherit;
    }

    /* Syntax highlighting for comments */
    .code-block code {
        color: inherit;
    }

    /* Better visual hierarchy for structure */
    .code-block {
        tab-size: 2;
        -moz-tab-size: 2;
    }

    .metric-card {
        background: var(--bg-primary);
        padding: 1rem;
        border-radius: 10px;
        border: 1px solid var(--border-color);
        margin: 0.5rem 0;
    }

    .metric-value {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--accent-primary);
    }

    .training-image {
        max-width: 100%;
        border-radius: 10px;
        box-shadow: 0 5px 15px var(--shadow);
        margin: 1rem 0;
    }

    .architecture-diagram {
        background: var(--bg-primary);
        padding: 1.5rem;
        border-radius: 10px;
        border: 1px solid var(--border-color);
        margin: 1rem 0;
    }

    .step-list {
        list-style: none;
        padding-left: 0;
    }

    .step-list li {
        padding: 0.75rem;
        margin: 0.5rem 0;
        background: var(--bg-primary);
        border-radius: 8px;
        border-left: 3px solid var(--accent-primary);
    }

    .step-list li::before {
        content: counter(step-counter);
        counter-increment: step-counter;
        background: var(--accent-primary);
        color: white;
        width: 25px;
        height: 25px;
        border-radius: 50%;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        margin-right: 1rem;
        font-weight: 700;
        font-size: 0.85rem;
    }

    .step-list {
        counter-reset: step-counter;
    }
</style>

<div class="container">
    <div class="text-center mb-4 fade-in" data-aos="fade-down">
        <h1 class="h3 fw-bold mb-2">
            <span class="gradient-text">Project Documentation</span>
        </h1>
        <p style="color: var(--text-secondary); font-size: 0.95rem;">
            Complete technical documentation for LeafLens - AI-Powered Plant Disease Detection System
        </p>
    </div>

    <!-- Tech Stack Section -->
    <div class="doc-section" data-aos="fade-up">
        <h3><i class="fas fa-layer-group me-2"></i>Technology Stack</h3>
        <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1.5rem;">
            LeafLens is built using modern web technologies and deep learning frameworks.
        </p>
        
        <div class="tech-stack-grid">
            <div class="tech-item">
                <h5>Backend</h5>
                <p style="color: var(--text-secondary); font-size: 0.85rem; margin: 0;">Flask 3.1.2</p>
                <p style="color: var(--text-secondary); font-size: 0.85rem; margin: 0;">Python 3.13</p>
            </div>
            <div class="tech-item">
                <h5>Deep Learning</h5>
                <p style="color: var(--text-secondary); font-size: 0.85rem; margin: 0;">PyTorch 2.9.1</p>
                <p style="color: var(--text-secondary); font-size: 0.85rem; margin: 0;">Torchvision 0.24.1</p>
            </div>
            <div class="tech-item">
                <h5>Data Processing</h5>
                <p style="color: var(--text-secondary); font-size: 0.85rem; margin: 0;">NumPy 2.4.0</p>
                <p style="color: var(--text-secondary); font-size: 0.85rem; margin: 0;">Pandas 2.3.3</p>
            </div>
            <div class="tech-item">
                <h5>Image Processing</h5>
                <p style="color: var(--text-secondary); font-size: 0.85rem; margin: 0;">Pillow 12.1.0</p>
                <p style="color: var(--text-secondary); font-size: 0.85rem; margin: 0;">OpenCV (via torchvision)</p>
            </div>
            <div class="tech-item">
                <h5>Frontend</h5>
                <p style="color: var(--text-secondary); font-size: 0.85rem; margin: 0;">HTML5, CSS3</p>
                <p style="color: var(--text-secondary); font-size: 0.85rem; margin: 0;">Bootstrap 5.3.2</p>
                <p style="color: var(--text-secondary); font-size: 0.85rem; margin: 0;">JavaScript</p>
            </div>
            <div class="tech-item">
                <h5>Deployment</h5>
                <p style="color: var(--text-secondary); font-size: 0.85rem; margin: 0;">Gunicorn 23.0.0</p>
                <p style="color: var(--text-secondary); font-size: 0.85rem; margin: 0;">WSGI Server</p>
            </div>
        </div>
    </div>

    <!-- Project Architecture Section -->
    <div class="doc-section" data-aos="fade-up" data-aos-delay="100">
        <h3><i class="fas fa-sitemap me-2"></i>Project Architecture</h3>
        <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">
            LeafLens follows a modular architecture with clear separation of concerns.
        </p>
        
        <div class="architecture-diagram">
            <h5 class="fw-bold mb-3">System Components:</h5>
            <ul style="color: var(--text-secondary); line-height: 2;">
                <li><strong>Frontend Layer:</strong> Responsive web interface with dark/light mode support</li>
                <li><strong>Flask Backend:</strong> RESTful API handling image uploads and predictions</li>
                <li><strong>Model Layer:</strong> ResNet50 deep learning model for disease classification</li>
                <li><strong>Data Layer:</strong> CSV files for disease information and supplement recommendations</li>
            </ul>
        </div>

        <h5 class="fw-bold mt-4 mb-3">Project Structure:</h5>
        <pre class="code-block"><code>App/
├── app.py                 # Flask application and routes
├── CNN.py                 # Custom CNN architecture (alternative model)
├── train_model.py         # Model training script
├── trained_model.pth      # Trained ResNet50 model weights
├── requirements.txt       # Python dependencies
├── disease_info.csv       # Disease descriptions and treatments
├── supplement_info.csv    # Supplement recommendations
├── static/
│   └── uploads/          # User uploaded images
└── templates/            # HTML templates
    ├── base.html
    ├── home.html
    ├── index.html
    ├── submit.html
    ├── market.html
    ├── contact-us.html
    └── documentation.html</code></pre>
    </div>

    <!-- Model Architecture Section -->
    <div class="doc-section" data-aos="fade-up" data-aos-delay="200">
        <h3><i class="fas fa-brain me-2"></i>Model Architecture</h3>
        <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">
            The system uses ResNet50, a deep residual network, for plant disease classification.
        </p>
        
        <div class="architecture-diagram">
            <h5 class="fw-bold mb-3">ResNet50 Architecture:</h5>
            <ul style="color: var(--text-secondary); line-height: 2;">
                <li><strong>Base Model:</strong> ResNet50 pretrained on ImageNet (IMAGENET1K_V2 weights)</li>
                <li><strong>Transfer Learning:</strong> Full fine-tuning of all layers</li>
                <li><strong>Input Size:</strong> 224×224 RGB images</li>
                <li><strong>Output Classes:</strong> 39 plant disease classes</li>
                <li><strong>Total Parameters:</strong> ~25 million trainable parameters</li>
            </ul>
        </div>

        <h5 class="fw-bold mt-4 mb-3">Key Features:</h5>
        <ul style="color: var(--text-secondary); line-height: 2;">
            <li>Residual connections for better gradient flow</li>
            <li>Batch normalization for stable training</li>
            <li>ImageNet pretrained weights for better feature extraction</li>
            <li>Custom fully connected layer for 39-class classification</li>
        </ul>
    </div>

    <!-- Training Process Section -->
    <div class="doc-section" data-aos="fade-up" data-aos-delay="300">
        <h3><i class="fas fa-cogs me-2"></i>Training Process</h3>
        <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">
            The model was trained on the PlantVillage dataset using transfer learning.
        </p>

        <h5 class="fw-bold mb-3">Dataset Information:</h5>
        <div class="metric-card">
            <p style="margin: 0;"><strong>Dataset:</strong> {% if training_data %}{{ training_data['dataset']['name'] }}{% else %}PlantVillage{% endif %}</p>
            <p style="margin: 0;"><strong>Total Classes:</strong> {% if training_data %}{{ training_data['num_classes'] }}{% else %}39{% endif %} plant disease categories</p>
            <p style="margin: 0;"><strong>Training Samples:</strong> {% if training_data %}{{ "{:,}".format(training_data['dataset']['train_samples']) }}{% else %}18,801{% endif %} images</p>
            <p style="margin: 0;"><strong>Validation Samples:</strong> {% if training_data %}{{ "{:,}".format(training_data['dataset']['val_samples']) }}{% else %}5,733{% endif %} images</p>
            <p style="margin: 0;"><strong>Test Samples:</strong> {% if training_data %}{{ "{:,}".format(training_data['dataset']['test_samples']) }}{% else %}5,755{% endif %} images</p>
            <p style="margin: 0;"><strong>Split Ratio:</strong> 70% / 15% / 15%</p>
        </div>

        <h5 class="fw-bold mt-4 mb-3">Training Configuration:</h5>
        <div class="metric-card">
            <p style="margin: 0;"><strong>Optimizer:</strong> {% if training_data %}{{ training_data['hyperparameters']['optimizer'] }}{% else %}Adam{% endif %}</p>
            <p style="margin: 0;"><strong>Learning Rate:</strong> {% if training_data %}{{ training_data['hyperparameters']['learning_rate'] }}{% else %}0.001{% endif %}</p>
            <p style="margin: 0;"><strong>Batch Size:</strong> {% if training_data %}{{ training_data['hyperparameters']['batch_size'] }}{% else %}32{% endif %}</p>
            <p style="margin: 0;"><strong>Epochs:</strong> {% if training_data %}{{ training_data['hyperparameters']['num_epochs'] }}{% else %}20{% endif %}</p>
            <p style="margin: 0;"><strong>Scheduler:</strong> {% if training_data %}{{ training_data['hyperparameters']['scheduler'] }}{% else %}StepLR (step_size=7, gamma=0.1){% endif %}</p>
            <p style="margin: 0;"><strong>Loss Function:</strong> CrossEntropyLoss</p>
            {% if training_data %}
            <p style="margin: 0.5rem 0 0 0; color: var(--text-secondary); font-size: 0.85rem;"><strong>Training Date:</strong> {{ training_data['training_date'] }}</p>
            {% endif %}
        </div>

        <h5 class="fw-bold mt-4 mb-3">Data Augmentation:</h5>
        <ul style="color: var(--text-secondary); line-height: 2;">
            <li>Random horizontal flip</li>
            <li>Random rotation (±10 degrees)</li>
            <li>Color jitter (brightness and contrast)</li>
            <li>ImageNet normalization (mean=[0.485, 0.456, 0.406], std=[0.229, 0.224, 0.225])</li>
        </ul>

        <h5 class="fw-bold mt-4 mb-3">Training Steps:</h5>
        <ol class="step-list">
            <li>Dataset preparation: Split raw data into train/val/test sets (70/15/15)</li>
            <li>Data loading: Create DataLoaders with appropriate transforms</li>
            <li>Model initialization: Load pretrained ResNet50 and replace final layer</li>
            <li>Training loop: Train for 20 epochs with validation monitoring</li>
            <li>Model selection: Save best model based on validation accuracy</li>
            <li>Evaluation: Test on held-out test set</li>
            <li>Metrics generation: Generate confusion matrices and performance plots</li>
        </ol>
    </div>

    <!-- Training Results Section -->
    <div class="doc-section" data-aos="fade-up" data-aos-delay="400">
        <h3><i class="fas fa-chart-line me-2"></i>Training Results</h3>
        <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">
            The model achieved excellent performance on both validation and test sets.
        </p>

        <div class="row">
            <div class="col-md-6 mb-3">
                <div class="metric-card">
                    <h5 class="fw-bold mb-2">Validation Set</h5>
                    {% if training_data %}
                    <div class="metric-value">{{ training_data['validation_metrics']['accuracy_pct'] }}%</div>
                    <p style="color: var(--text-secondary); font-size: 0.85rem; margin: 0.5rem 0 0 0;">Accuracy</p>
                    <p style="color: var(--text-secondary); font-size: 0.85rem; margin: 0;">F1-Score (Macro): {{ training_data['validation_metrics']['f1_macro_str'] }}</p>
                    <p style="color: var(--text-secondary); font-size: 0.85rem; margin: 0;">F1-Score (Weighted): {{ training_data['validation_metrics']['f1_weighted_str'] }}</p>
                    {% else %}
                    <div class="metric-value">99.97%</div>
                    <p style="color: var(--text-secondary); font-size: 0.85rem; margin: 0.5rem 0 0 0;">Accuracy</p>
                    <p style="color: var(--text-secondary); font-size: 0.85rem; margin: 0;">F1-Score (Macro): 0.9997</p>
                    <p style="color: var(--text-secondary); font-size: 0.85rem; margin: 0;">F1-Score (Weighted): 0.9997</p>
                    {% endif %}
                </div>
            </div>
            <div class="col-md-6 mb-3">
                <div class="metric-card">
                    <h5 class="fw-bold mb-2">Test Set</h5>
                    {% if training_data %}
                    <div class="metric-value">{{ training_data['test_metrics']['accuracy_pct'] }}%</div>
                    <p style="color: var(--text-secondary); font-size: 0.85rem; margin: 0.5rem 0 0 0;">Accuracy</p>
                    <p style="color: var(--text-secondary); font-size: 0.85rem; margin: 0;">F1-Score (Macro): {{ training_data['test_metrics']['f1_macro_str'] }}</p>
                    <p style="color: var(--text-secondary); font-size: 0.85rem; margin: 0;">F1-Score (Weighted): {{ training_data['test_metrics']['f1_weighted_str'] }}</p>
                    {% else %}
                    <div class="metric-value">99.93%</div>
                    <p style="color: var(--text-secondary); font-size: 0.85rem; margin: 0.5rem 0 0 0;">Accuracy</p>
                    <p style="color: var(--text-secondary); font-size: 0.85rem; margin: 0;">F1-Score (Macro): 0.9994</p>
                    <p style="color: var(--text-secondary); font-size: 0.85rem; margin: 0;">F1-Score (Weighted): 0.9993</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <h5 class="fw-bold mt-4 mb-3">Training History:</h5>
        <div class="text-center">
            <img src="/static/training_results/training_history.png" alt="Training History" class="training-image" 
                 onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <p style="display: none; color: var(--text-secondary);">Training history plot not available</p>
        </div>

        <h5 class="fw-bold mt-4 mb-3">Confusion Matrices:</h5>
        <div class="row">
            <div class="col-md-6 mb-3">
                <h6 class="fw-bold mb-2">Validation Set</h6>
                <img src="/static/training_results/confusion_matrix_validation.png" alt="Validation Confusion Matrix" 
                     class="training-image" onerror="this.style.display='none';">
            </div>
            <div class="col-md-6 mb-3">
                <h6 class="fw-bold mb-2">Test Set</h6>
                <img src="/static/training_results/confusion_matrix_test.png" alt="Test Confusion Matrix" 
                     class="training-image" onerror="this.style.display='none';">
            </div>
        </div>

        <h5 class="fw-bold mt-4 mb-3">Per-Class Performance:</h5>
        <p style="color: var(--text-secondary); font-size: 0.9rem;">
            The model achieved near-perfect performance across all 39 classes, with most classes showing 
            100% precision, recall, and F1-score. The few classes with slightly lower metrics still maintain 
            excellent performance above 99%.
        </p>
    </div>

    <!-- How to Use Section -->
    <div class="doc-section" data-aos="fade-up" data-aos-delay="500">
        <h3><i class="fas fa-book me-2"></i>How to Use</h3>
        <h5 class="fw-bold mb-3">For End Users:</h5>
        <ol class="step-list">
            <li>Navigate to the AI Engine page</li>
            <li>Upload an image of a plant leaf (JPG, PNG, or JPEG format)</li>
            <li>Click "Analyze Image" to get instant disease detection</li>
            <li>View detailed results including disease description, prevention steps, and recommended supplements</li>
        </ol>

        <h5 class="fw-bold mt-4 mb-3">For Developers:</h5>
        <pre class="code-block"><code># Installation
cd App
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
pip install -r requirements.txt

# Run the application
python app.py

# Access at http://127.0.0.1:5000</code></pre>
    </div>

    <!-- References Section -->
    <div class="doc-section" data-aos="fade-up" data-aos-delay="600">
        <h3><i class="fas fa-link me-2"></i>References & Resources</h3>
        <ul style="color: var(--text-secondary); line-height: 2;">
            <li><strong>Dataset:</strong> PlantVillage Dataset - <a href="https://www.kaggle.com/datasets/abdallahalidev/plantvillage-dataset" target="_blank" style="color: var(--accent-primary);">Kaggle</a></li>
            <li><strong>Model:</strong> ResNet50 - Deep Residual Learning for Image Recognition</li>
            <li><strong>Framework:</strong> PyTorch - <a href="https://pytorch.org" target="_blank" style="color: var(--accent-primary);">pytorch.org</a></li>
            <li><strong>Web Framework:</strong> Flask - <a href="https://flask.palletsprojects.com" target="_blank" style="color: var(--accent-primary);">flask.palletsprojects.com</a></li>
        </ul>
    </div>
</div>

{% endblock body %}

